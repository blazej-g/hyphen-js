/**
 * @version v0.0.294 - 2016-12-03 */var jsHyphen=angular.module("jsHyphen",[]);jsHyphen.provider("Hyphen",[function(){var a={};return a.initialize=function(){},a.$get=["$rootScope","$http","$q","$injector","$timeout","HyphenDataProvider","HyphenAPI","HyphenCache",function(a,b,c,d,e,f,g,h){var i={};return i.initialize=function(a){this.configuration=a,_(a.model).each(function(a,b,c){a.name=b,i[a.name]={},i[a.name].provider=new f(a)}),_(a.model).each(function(b,c,d){b.name=c,i[b.name].api=new g(i,b,a)})},i.dispose=function(){this.configuration.model.forEach(function(a){i[a.name].provider.clearData()}),h.clearCache()},i}],a}]),jsHyphen.factory("HyphenAPI",["ApiCallFactory","$injector","$q",function(a,b,c){var d=function(d,e,f,g){this._Hyphen=d,this.loading=0,this.modelConfiguration=e,this.globalConfiguration=f;var h=this;_(e.rest).each(function(d){var g=this,i=new a(d,f,e.name);this[d.name]=function(a,j){var k=c.defer(),l=i.getApiCall(a,j);g[d.name].loading++,g.loading++,g[d.name].loaded=!1;var m=b.has(e.name+"Interceptor")?b.get(e.name+"Interceptor"):null;return m&&m[d.name+"Post"]?m[d.name+"Post"](k.promise,e.name,d):f.responseInterceptor?f.responseInterceptor(k.promise,e.name,d):k.promise.then(function(a){g.saveResult(h._Hyphen,h.modelConfiguration,d,a.data)}),l.then(function(a){g[d.name].loading--,g.loading--,g[d.name].loaded=!0,k.resolve(a)},function(a){k.reject(a)},function(a){k.notify(a)}),k.promise},g[d.name].loading=0},this)};return d.prototype.saveResult=function(a,b,c,d){var e=this,d=Array.isArray(d)?d:[d];_(d).each(function(d){for(var f in b.embedObjects){var g=b.embedObjects[f];if(d[f]){var h=Array.isArray(d[f])?d[f]:[d[f]];e.saveResult(a,e.globalConfiguration.model[g],c,h),delete d[f]}}a[b.name].provider[c.method](d)}),e._Hyphen[e.modelConfiguration.name].provider.clearIndexes()},d}]),jsHyphen.factory("ApiCallFactory",["HyphenPost","HyphenGet","HyphenPut","HyphenDelete","HyphenFilePost","$q","HyphenCache",function(a,b,c,d,e,f,g){var h=function(f,g,h){switch(this.apiCallConfiguration=f,this.modelName=h,f.method){case"get":this.callType=b;break;case"post":this.callType=a;break;case"put":this.callType=c;break;case"delete":this.callType=d;break;case"filePost":this.callType=e}this.apiCall=new this.callType(f,g)};return h.prototype.getApiCall=function(a,b){var c=this.apiCallConfiguration.name+this.modelName+JSON.stringify(a);return g.isCached(c)?f.resolve({data:{cached:!0}}):(this.apiCallConfiguration.cache&&"get"===this.apiCallConfiguration.method&&g.addUrl(c),this.apiCall.invoke.call(this.apiCall,a,b))},h}]),jsHyphen.factory("HyphenBaseModel",[function(){var a=function(a){_.extend(this,angular.copy(a))};return a.createModelPrototype=function(b){return Object.create(a.prototype)},a}]),jsHyphen.factory("HyphenCache",[function(){var a={};return this.addUrl=function(b){a[b]=!0},this.isCached=function(b){return a[b]},this.clearCache=function(){a={}},this}]),jsHyphen.factory("HyphenDataProvider",["$rootScope","$injector",function(a,b){var c=function(a){if(this.modelConfiguration=a,this.clearData(),!b.has(a.model))throw new Error("Model not defined for: "+a.model);this.modelClass=b.get(a.model);var c=this;c.modelClass.indexes&&Object.keys(c.modelClass.indexes).forEach(function(a){c["getBy"+c.modelClass.indexes[a]]=function(b){return c.getIndexedData(a,b)}}),c.modelClass.groups&&Object.keys(c.modelClass.groups).forEach(function(a){c["getGroupBy"+c.modelClass.groups[a]]=function(b){return c.getGroupedData(a,b)}})};return c.prototype.data=[],c.prototype.clearData=function(){this.data=[],this.metaData={},this.clearIndexes()},c.prototype.clearIndexes=function(){this.indexedData={},this.groupedData={},this.sorted=!1},c.prototype.getIndexedData=function(a,b){return this.indexedData[a]||(this.indexedData[a]=_(this.getData()).indexBy(a)),this.indexedData[a][b]},c.prototype.getGroupedData=function(a,b){return this.groupedData[a]||(this.groupedData[a]=_(this.getData()).groupBy(a)),this.groupedData[a][b]?this.groupedData[a][b]:[]},c.prototype.where=function(a){var b="",c="";for(var d in a)b+=d+"|",c+=a[d]+"|";return this.groupedData[b]||(this.groupedData[b]=_(this.getData()).groupBy(function(b){var c="";for(var d in a)c+=b[d]+"|";return c})),this.groupedData[b][c]?this.groupedData[b][c]:[]},c.prototype.findOne=function(a){var b=this.where(a);return b.length>0?b[0]:null},c.prototype.getData=function(){var a=this;return a.modelClass.sort&&!a.sorted&&(this.data=this.data=_(this.data).sortBy(function(b){return a.modelClass.sort.desc?b[a.modelClass.sort.desc]?b[a.modelClass.sort.desc].toLowerCase():b[a.modelClass.sort.desc]:a.modelClass.sort.asc?b[a.modelClass.sort.asc]?b[a.modelClass.sort.asc].toLowerCase():b[a.modelClass.sort.asc]:void 0}),a.modelClass.sort.desc&&(this.data=this.data.reverse()),a.sorted=!0),this.data},c.prototype["delete"]=function(a){var b=this,c=a&&a[b.modelConfiguration.key]?a[b.modelConfiguration.key]:a;this.data=_(this.data).filter(function(a){return a[b.modelConfiguration.key]!==c})},c.prototype.put=function(a){var b=this,c=_(b.data).find(function(c){return c[b.modelConfiguration.key]===a[b.modelConfiguration.key]});if(c){var d=_.extend(new b.modelClass(a),a);b.data=_([d].concat(b.data)).uniq(!1,function(a){return a[b.modelConfiguration.key]})}else{var e=_.extend(new b.modelClass(a),a);b.data.push(e)}},c.prototype.post=function(a){var b=this,c=_(b.data).find(function(c){return c[b.modelConfiguration.key]===a[b.modelConfiguration.key]});if(c){var d=_.extend(new b.modelClass(a),a);b.data=_([d].concat(b.data)).uniq(!1,function(a){return a[b.modelConfiguration.key]})}else{var e=_.extend(new b.modelClass(a),a);b.data.push(e)}},c.prototype.get=function(a){var b=this,c=_(b.data).find(function(c){return c[b.modelConfiguration.key]===a[b.modelConfiguration.key]});if(c){var d=_.extend(new b.modelClass(a),a);b.data=_([d].concat(b.data)).uniq(!1,function(a){return a[b.modelConfiguration.key]})}else{var e=_.extend(new b.modelClass(a),a);b.data.push(e)}},c}]),jsHyphen.factory("HyphenCallBase",[function(){var a=function(a,b){this.httpOptions=a,this.hyphenConfiguration=b,this.config={}};a.prototype.urlParser=function(a,b){for(var c in b)a=a.replace(":"+c,b[c]);return a};var b=function(a,b){return a.match(b+"$")===b};return a.prototype.invoke=function(a,c){this.config=angular.copy(this.httpOptions);var d="";return b(this.hyphenConfiguration.baseUrl,"/")||(d=this.hyphenConfiguration.baseUrl),a?this.config.url=d+this.urlParser(this.httpOptions.url,a):this.config.url=d+this.httpOptions.url,this.config.data=c,this.hyphenConfiguration.requestInterceptor&&(this.config=this.hyphenConfiguration.requestInterceptor(this.config)),this.config.cache=!1,this.$http(this.config)},a}]),jsHyphen.factory("HyphenGet",["HyphenCallBase","$http",function(a,b){var c=function(c,d){a.call(this,c,d),this.$http=b};return c.prototype=Object.create(a.prototype),c}]),jsHyphen.factory("HyphenPost",["HyphenCallBase","$http",function(a,b){var c=function(c,d){a.call(this,c,d),this.$http=b};return c.prototype=Object.create(a.prototype),c}]),jsHyphen.factory("HyphenPut",["HyphenCallBase","$http",function(a,b){var c=function(c,d){a.call(this,c,d),this.$http=b};return c.prototype=Object.create(a.prototype),c}]),jsHyphen.factory("HyphenDelete",["HyphenCallBase","$http",function(a,b){var c=function(c,d){a.call(this,c,d),this.$http=b};return c.prototype=Object.create(a.prototype),c}]),jsHyphen.factory("HyphenFilePost",["HyphenCallBase","$http","$q",function(a,b,c){var d=function(b,d){a.call(this,b,d),this.httpOptions.method="POST",this.$http=function(a){var b=new XMLHttpRequest;b.open("POST",a.url,!0);var d=c.defer();return b.upload.addEventListener("progress",function(a){a.progress=Math.round(100*(a.loaded/a.total).toFixed(2)),d.notify(a)},!0),b.addEventListener("error",function(a){d.reject(a)},!0),b.addEventListener("abort",function(a){a.aborted=!0,d.reject(a)},!0),b.onreadystatechange=function(a){if((403==b.status||404==b.status||500==b.status||422==b.status)&&d.reject(a),4==b.readyState&&200==b.status){var a=JSON.parse(b.response);a.errors&&a.errors.file?d.reject(a):d.resolve({data:a})}},b.send(a.data),d.promise.abort=function(){b.abort()},d.promise}};return d.prototype=Object.create(a.prototype),d}]);